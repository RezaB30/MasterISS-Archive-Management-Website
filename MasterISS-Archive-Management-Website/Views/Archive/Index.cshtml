@using MasterISS_Archive_Management_Website.ViewModels
@model IEnumerable<FileDetailViewModel>


@{
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    Layout = "~/Views/Shared/_Layout.cshtml";
    if (ViewBag.id == null)
    {
        ViewBag.Title = MasterISS_Archive_Management_Website.Localization.Model.HomePage;
    }
    else
    {
        ViewBag.Title = ViewBag.id + " - " + MasterISS_Archive_Management_Website.Localization.Model.SubscriberArchiveFiles;
    }
}

@*<style>
        #visible-manage-button {
            display: none
        }
        .hidden-part {
            display: none
        }
    </style>*@

@if (ViewBag.id != null)
{
    <style>
        #visible-manage-button {
            display: block
        }
    </style>
}

<div class="container">
    @using (Html.BeginForm(null, null, FormMethod.Get))
    {
        <div class="home-page">
            <div>
                @Html.TextBox("id")
            </div>

            <div class="home-page">
                <button type="submit">@MasterISS_Archive_Management_Website.Localization.Model.Search</button>
            </div>
        </div>

    }
    <div class="message">
        @ViewBag.NoSubscriberFound
        @ViewBag.HasArchiveFileMessage
        @ViewBag.IdValidationMessage
    </div>


    @if (Model != null)
    {
        <table>
            <tr class="home-page">
                <td>
                    @Html.DisplayNameFor(model => model.AttachmentType)
                </td>
                <td>
                    @Html.DisplayNameFor(model => model.CreationDate)
                </td>
                <td colspan="2">
                </td>
            </tr>

            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.AttachmentType)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CreationDate)
                    </td>
                    <td>
                        <a href="@Url.Action("Download", "Archive", new { id = ViewBag.id, FileName = item.ServerSideName })">@MasterISS_Archive_Management_Website.Localization.Model.Download</a>
                    </td>
                    <td>
                        @using (Html.BeginForm("Delete", "Archive", FormMethod.Post, new { @class = "delete-submit" }))
                        {
                            <div class="hidden-part">
                                @Html.TextBox("id")

                                @Html.Hidden("serverSideName", item.ServerSideName)
                            </div>

                            <button type="submit">@MasterISS_Archive_Management_Website.Localization.Model.Delete</button>
                        }
                    </td>
                </tr>
            }

        </table>
        <a href="@Url.Action("DownloadZipFile", "Archive",  new { id= ViewBag.id})">@MasterISS_Archive_Management_Website.Localization.Model.DownloadAll</a>

    }

    <div id="visible-manage-button">
        <a href="@Url.Action("Manage", "Archive",  new { id= ViewBag.id})">@MasterISS_Archive_Management_Website.Localization.Model.Manage</a>
    </div>
</div>


@section script{

    <script>
        $(".delete-submit").submit(function (e) {
            if (!confirm("Are You Sure?")) {
                e.preventDefault();
            }
        });
    </script>
    <script>
        $("#id").on("input", function () {
            var id = $(this);
            var idVal = id.val();
            var reg = /^\d+$/;

            reg.test(idVal) ? this.value : this.value = this.value.slice(0, -1)
        })
    </script>

}

