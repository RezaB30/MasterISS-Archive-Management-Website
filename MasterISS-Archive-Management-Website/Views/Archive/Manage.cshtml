@model MasterISS_Archive_Management_Website.ViewModels.UploadFileViewModel
@using MasterISS_Archive_Management_Website.ViewModels

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    <style>
        .file-area {
            display: none
        }
    </style>
}

<div class="container">
    <div>
        <h1 class="home-page">
            @MasterISS_Archive_Management_Website.Localization.Model.ArchiveNumber  @ViewBag.id
        </h1>

        <div class="message">
            @ViewBag.FileSizeError
            @ViewBag.FileCountError
            @ViewBag.UploadStatus
            @ViewBag.UploadFileStatus
        </div>

        @ViewBag.Exception

        @foreach (var item in Model.AttachmentTypeList)
        {
            <table>
                <tr>
                    @Html.DisplayFor(model => item.AttachmentTypeEnumName)
                </tr>

                @if (Model.FileDetailList != null)
                {
                    foreach (var fileItem in Model.FileDetailList)
                    {
                        if (item.AttachmentTypeEnumNumber == fileItem.AttachmentType)
                        {
                            <tr>
                                <td>
                                    @Html.DisplayFor(model => fileItem.CreationDate)
                                </td>                               
                                <td>
                                    <a href="@Url.Action("Download", "Archive", new { id = ViewBag.id,FileName = fileItem.ServerSideName })">@MasterISS_Archive_Management_Website.Localization.Model.Download</a>
                                </td>
                                <td>

                                    @using (Html.BeginForm("Delete", "Archive", FormMethod.Post, new { @class = "delete-submit" }))
                                    {
                                        <div class="hidden-part">
                                            @Html.TextBox("id")

                                            @Html.Hidden("serverSideName", fileItem.ServerSideName)
                                        </div>

                                        <button type="submit">@MasterISS_Archive_Management_Website.Localization.Model.Delete</button>
                                    }
                                </td>
                            </tr>
                        }
                    }
                }
                <tr>
                    <td colspan="5">

                        @using (Html.BeginForm("Manage", "Archive", new { id = ViewContext.RouteData.Values["id"] }, FormMethod.Post, new { enctype = "multipart/form-data", @class = "upload-submit" }))
                        {
                            <div class="file-area">
                                @Html.Hidden("AttachmentType", item.AttachmentTypeEnumNumber)
                                <input class="file-input-name" type="hidden" value="@Html.NameFor(m=>m.Files)" />

                                <div class="drop-zone drag-area "></div>

                                <div class="file-input-container" style="display: none;"></div>

                                <button type="submit" class="upload-button">@MasterISS_Archive_Management_Website.Localization.Model.Save</button>
                                <button type="button" class="clear-button">@MasterISS_Archive_Management_Website.Localization.Model.Clear</button>

                                <div class="uploading-files">
                                    @MasterISS_Archive_Management_Website.Localization.Model.FileisUploading
                                </div>
                            </div>
                            <button class="area-for-upload-button" type="button">Dosya Yükle</button>
                        }
                    </td>
                </tr>
            </table>
        }
    </div>
</div>
@section script{
    @Scripts.Render("~/Scripts/Up-file.js")

    <script>
        SetupFileUploadAreas();
    </script>
    <script>
        $(".delete-submit").submit(function (e) {
            if (!confirm("Are You Sure?")) {
                e.preventDefault();
            }
        });
    </script>
    <script>
        $('.clear-button').click(function () {

            var button = $(this);
            var uploadForm = button.closest('.upload-submit');
            var uploadFormInputName = uploadForm.find('.file-input-container');
            var uploadFormInputFiles = uploadFormInputName.find('input[type="file"]');
            //uploadFormInputName.removeAttr('name');
            uploadFormInputFiles.removeAttr('name');

            $('.drag-area').empty();

        })
    </script>
    <script>
        $('.upload-button').click(function () {
            $(".upload-button").hide();
            $(".clear-button").hide();

            $(".uploading-files").show();


        })
    </script>
    <script>
        $('button.area-for-upload-button').click(function () {
            var uploadAreaButton = $(this);
            var uploadForm = uploadAreaButton.closest(".upload-submit");
            var uploadFileArea = uploadForm.find(".file-area");

            var fileAreaButton = uploadForm.find(".area-for-upload-button");

            if ($(".file-area").is(":visible")) {
                $(".file-area").hide();
            }
            $(".area-for-upload-button").show();

            fileAreaButton.hide();
            uploadFileArea.show();

        })
    </script>

}

